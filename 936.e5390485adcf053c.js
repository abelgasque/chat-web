(self.webpackChunksecurityapp=self.webpackChunksecurityapp||[]).push([[936],{936:(T,r,n)=>{"use strict";n.r(r),n.d(r,{SupersetModule:()=>w});var E=n(6895),i=n(9299),s=n(4650),m=n(529),u=n(2340);let h=(()=>{class e{constructor(t){this.http=t,this.baseUrl=`${u.N.baseUrlApi}/api/superset/guest_token`,this.supersetUrl=u.N.supersetConfig.url,this.headers=new m.WM({Authorization:`Bearer ${localStorage.getItem("access_token")}`})}guestToken(t,f){return this.http.post(this.baseUrl,{id:t,clauses:f},{headers:this.headers})}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(m.eN))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var o=n(5861),g=n(840);const l=["supersetContainer"];let c=(()=>{class e{constructor(){}ngOnInit(){this.embedSupersetDashboard()}embedSupersetDashboard(){var t=this;return(0,o.Z)(function*(){try{const f=t.mountPoint.nativeElement;yield(0,g.Z)({id:t.id,supersetDomain:t.url,mountPoint:f,fetchGuestToken:(S=(0,o.Z)(function*(){return t.token}),function(){return S.apply(this,arguments)}),dashboardUiConfig:{hideTitle:!0,filters:{expanded:!0},urlParams:{}},iframeSandboxExtras:["allow-top-navigation","allow-popups-to-escape-sandbox"],referrerPolicy:"same-origin"})}catch(f){console.error("Erro ao buscar token ou embutir dashboard:",f)}var S})()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-superset-dashboard"]],viewQuery:function(t,f){if(1&t&&s.Gf(l,7),2&t){let S;s.iGM(S=s.CRH())&&(f.mountPoint=S.first)}},inputs:{id:"id",url:"url",token:"token"},decls:2,vars:0,consts:[["id","superset-container"],["supersetContainer",""]],template:function(t,f){1&t&&s._UZ(0,"div",0,1)},encapsulation:2}),e})();const d=[{path:":id",component:(()=>{class e{constructor(t,f){this.route=t,this.supersetService=f}ngOnInit(){this.id=this.route.snapshot.paramMap.get("id")||"",console.log("id acesso recebido:",this.id),this.guestToken(this.id,[])}guestToken(t,f){this.supersetService.guestToken(t,f).subscribe({next:S=>{console.log("Token guest recebido:",S),this.token=S.token},error:S=>{console.error("Erro ao buscar guest token:",S)}})}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(i.gz),s.Y36(h))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-superset"]],decls:1,vars:3,consts:[[3,"id","url","token"]],template:function(t,f){1&t&&s._UZ(0,"app-superset-dashboard",0),2&t&&s.Q6J("id",f.id)("url",f.supersetService.supersetUrl)("token",f.token)},dependencies:[c],styles:["app-superset-dashboard[_ngcontent-%COMP%], #superset-container[_ngcontent-%COMP%]{height:100%;width:100%;display:block}"]}),e})()}];let v=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[i.Bz.forChild(d),i.Bz]}),e})();var M=n(4703);let w=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({providers:[h],imports:[E.ez,i.Bz,v,M.m]}),e})()},2663:(T,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.IFRAME_COMMS_MESSAGE_TYPE=r.DASHBOARD_UI_FILTER_CONFIG_URL_PARAM_KEY=void 0,r.IFRAME_COMMS_MESSAGE_TYPE="__embedded_comms__",r.DASHBOARD_UI_FILTER_CONFIG_URL_PARAM_KEY={visible:"show_filters",expanded:"expand_filters"}},7021:(T,r,n)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.REFRESH_TIMING_BUFFER_MS=r.MIN_REFRESH_WAIT_MS=r.DEFAULT_TOKEN_EXP_MS=void 0,r.getGuestTokenRefreshTiming=function u(h){const o=(0,E.jwtDecode)(h),g=new Date(/[^0-9\.]/g.test(o.exp)?o.exp:1e3*parseFloat(o.exp));return("Invalid Date"!==g.toString()?Math.max(s,g.getTime()-Date.now()):m)-i};var E=n(1196);const i=r.REFRESH_TIMING_BUFFER_MS=5e3,s=r.MIN_REFRESH_WAIT_MS=1e4,m=r.DEFAULT_TOKEN_EXP_MS=3e5},840:(T,r,n)=>{"use strict";var i=n(7156).default;r.Z=function h(g){return o.apply(this,arguments)};var s=n(2663),m=n(7468),u=n(7021);function o(){return o=i(function*({id:g,supersetDomain:l,mountPoint:c,fetchGuestToken:p,dashboardUiConfig:d,debug:v=!1,iframeTitle:M="Embedded Dashboard",iframeSandboxExtras:w=[],referrerPolicy:e}){function a(...b){v&&console.debug(`[superset-embedded-sdk][dashboard ${g}]`,...b)}function t(){let b=0;return d&&(d.hideTitle&&(b+=1),d.hideTab&&(b+=2),d.hideChartControls&&(b+=8),d.emitDataMasks&&(b+=16)),b}function S(){return(S=i(function*(){return new Promise(b=>{const _=document.createElement("iframe"),k=d?{uiConfig:`${t()}`}:void 0,C=d?.filters||{},G=Object.keys(C),D={...k,...Object.fromEntries(G.map(y=>[s.DASHBOARD_UI_FILTER_CONFIG_URL_PARAM_KEY[y],C[y]])),...d?.urlParams},U=Object.keys(D).length?"?"+new URLSearchParams(D).toString():"";_.sandbox.add("allow-same-origin"),_.sandbox.add("allow-scripts"),_.sandbox.add("allow-presentation"),_.sandbox.add("allow-downloads"),_.sandbox.add("allow-forms"),_.sandbox.add("allow-popups"),w.forEach(y=>{_.sandbox.add(y)}),e&&(_.referrerPolicy=e),_.addEventListener("load",()=>{const y=new MessageChannel,L=y.port1;_.contentWindow.postMessage({type:s.IFRAME_COMMS_MESSAGE_TYPE,handshake:"port transfer"},l,[y.port2]),a("sent message channel to the iframe"),b(new m.Switchboard({port:L,name:"superset-embedded-sdk",debug:v}))}),_.src=`${l}/embedded/${g}${U}`,_.title=M,c.replaceChildren(_),a("placed the iframe")})})).apply(this,arguments)}a("embedding"),l.endsWith("/")&&(l=l.slice(0,-1));const[I,R]=yield Promise.all([p(),function f(){return S.apply(this,arguments)}()]);function P(){return A.apply(this,arguments)}function A(){return(A=i(function*(){const b=yield p();R.emit("guestToken",{guestToken:b}),setTimeout(P,(0,u.getGuestTokenRefreshTiming)(b))})).apply(this,arguments)}return R.emit("guestToken",{guestToken:I}),a("sent guest token"),setTimeout(P,(0,u.getGuestTokenRefreshTiming)(I)),{getScrollSize:()=>R.get("getScrollSize"),unmount:function F(){a("unmounting"),c.replaceChildren()},getDashboardPermalink:b=>R.get("getDashboardPermalink",{anchor:b}),getActiveTabs:()=>R.get("getActiveTabs"),observeDataMask:b=>{R.start(),R.defineMethod("observeDataMask",b)},getDataMask:()=>R.get("getDataMask"),setThemeConfig:function(){var b=i(function*(_){try{R.emit("setThemeConfig",{themeConfig:_}),a("Theme config sent successfully (or at least message dispatched)")}catch(k){throw a('Error sending theme config. Ensure the iframe side implements the "setThemeConfig" method.'),k}});return function(k){return b.apply(this,arguments)}}()}}),o.apply(this,arguments)}},7468:(T,r,n)=>{"use strict";n.r(r),n.d(r,{Switchboard:()=>o,default:()=>l});var E=n(5861),i=function(c){return c.GET="get",c.REPLY="reply",c.EMIT="emit",c.ERROR="error",c}(i||{});class o{constructor(p){this.port=void 0,this.name="",this.methods={},this.incrementor=1,this.debugMode=void 0,this.isInitialised=void 0,p&&this.init(p)}init(p){var d=this;if(this.isInitialised)return void this.logError("already initialized");const{port:v,name:M="switchboard",debug:w=!1}=p;this.port=v,this.name=M,this.debugMode=w,v.addEventListener("message",function(){var e=(0,E.Z)(function*(a){d.log("message received",a);const t=a.data;if(function s(c){return c.switchboardAction===i.GET}(t))d.port.postMessage(yield d.getMethodResult(t));else if(function u(c){return c.switchboardAction===i.EMIT}(t)){const{method:f,args:S}=t,I=d.methods[f];I&&I(S)}});return function(a){return e.apply(this,arguments)}}()),this.isInitialised=!0}getMethodResult(p){var d=this;return(0,E.Z)(function*({messageId:v,method:M,args:w}){const e=d.methods[M];if(null==e)return{switchboardAction:i.ERROR,messageId:v,error:`[${d.name}] Method "${M}" is not defined`};try{const a=yield e(w);return{switchboardAction:i.REPLY,messageId:v,result:a}}catch(a){return d.logError(a),{switchboardAction:i.ERROR,messageId:v,error:`[${d.name}] Method "${M}" threw an error`}}}).apply(this,arguments)}defineMethod(p,d){this.methods[p]=d}get(p,d){return new Promise((v,M)=>{if(!this.isInitialised)return void M(new Error("Switchboard not initialised"));const w=this.getNewMessageId(),e=t=>{const f=t.data;if(f.messageId===w)if(this.port.removeEventListener("message",e),function m(c){return c.switchboardAction===i.REPLY}(f))v(f.result);else{const S=function h(c){return c.switchboardAction===i.ERROR}(f)?f.error:"Unexpected response message";M(new Error(S))}};this.port.addEventListener("message",e),this.port.start(),this.port.postMessage({switchboardAction:i.GET,method:p,messageId:w,args:d})})}emit(p,d){this.isInitialised?this.port.postMessage({switchboardAction:i.EMIT,method:p,args:d}):this.logError("Switchboard not initialised")}start(){this.isInitialised?this.port.start():this.logError("Switchboard not initialised")}log(...p){this.debugMode&&console.debug(`[${this.name}]`,...p)}logError(...p){console.error(`[${this.name}]`,...p)}getNewMessageId(){return`m_${this.name}_${this.incrementor++}`}}const l=new o},1196:(T,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.jwtDecode=r.InvalidTokenError=void 0;class n extends Error{}r.InvalidTokenError=n,n.prototype.name="InvalidTokenError",r.jwtDecode=function s(m,u){if("string"!=typeof m)throw new n("Invalid token specified: must be a string");u||(u={});const h=!0===u.header?0:1,o=m.split(".")[h];if("string"!=typeof o)throw new n(`Invalid token specified: missing part #${h+1}`);let g;try{g=function i(m){let u=m.replace(/-/g,"+").replace(/_/g,"/");switch(u.length%4){case 0:break;case 2:u+="==";break;case 3:u+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function E(m){return decodeURIComponent(atob(m).replace(/(.)/g,(u,h)=>{let o=h.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}(u)}catch{return atob(u)}}(o)}catch(l){throw new n(`Invalid token specified: invalid base64 for part #${h+1} (${l.message})`)}try{return JSON.parse(g)}catch(l){throw new n(`Invalid token specified: invalid json for part #${h+1} (${l.message})`)}}},7156:T=>{function r(E,i,s,m,u,h,o){try{var g=E[h](o),l=g.value}catch(c){return void s(c)}g.done?i(l):Promise.resolve(l).then(m,u)}T.exports=function n(E){return function(){var i=this,s=arguments;return new Promise(function(m,u){var h=E.apply(i,s);function o(l){r(h,m,u,o,g,"next",l)}function g(l){r(h,m,u,o,g,"throw",l)}o(void 0)})}},T.exports.__esModule=!0,T.exports.default=T.exports},5861:(T,r,n)=>{"use strict";function E(s,m,u,h,o,g,l){try{var c=s[g](l),p=c.value}catch(d){return void u(d)}c.done?m(p):Promise.resolve(p).then(h,o)}function i(s){return function(){var m=this,u=arguments;return new Promise(function(h,o){var g=s.apply(m,u);function l(p){E(g,h,o,l,c,"next",p)}function c(p){E(g,h,o,l,c,"throw",p)}l(void 0)})}}n.d(r,{Z:()=>i})}}]);